{
  "scopeName": "source.myformat",
  "patterns": [
    {
      "include": "#comments"
    },
    {
      "include": "#blocks"
    }
  ],
  "repository": {
    "comments": {
      "patterns": [
        { 
          "name": "comment.line.double-slash", 
          "match": "//.*$" 
        },
        { 
          "name": "comment.block.myformat",
          "begin": "/\\*",
          "end": "\\*/",
          "patterns": [
            {
              "name": "comment.block.myformat",
              "match": "."
            }
          ]
        }
      ]
    },
    "blocks": {
      "patterns": [
        {
          "name": "meta.block.myformat",
          "begin": "(\\()([^\\)]+)(\\))",
          "beginCaptures": {
            "1": {
              "name": "punctuation.section.block.begin"
            },
            "2": {
              "name": "entity.name.type.class"
            },
            "3": {
              "name": "punctuation.section.block.end"
            }
          },
          "end": "\\}",
          "endCaptures": {
            "0": {
              "name": "punctuation.section.block.end"
            }
          },
          "patterns": [
            {
              "include": "#comments"
            },
            {
              "include": "#parameterLine"
            },
            {
              "include": "#blocks"
            }
          ]
        }
      ]
    },
    "parameterLine": {
      "patterns": [
        {
          "name": "meta.parameter.myformat",
          "begin": "^\\s*([A-Za-z_][A-Za-z0-9_\\[\\]]*)\\s+",
          "beginCaptures": {
            "1": {
              "patterns": [
                {
                  "match": "\\b(domain|cullMode|blendFunc|blendOp|dephFunc|depthClipEnable|depthBias|depthBiasClamp|slopeScaleDepthBias|scissorEnable|stencilOp|stencilFunc|fillMode|texture|filter|addressUV|define|antialiasedLineEnable|maxAnisotropy|mipLODBias|maxLOD|title|zEnable|zWriteEnable|mipLODBias)\\b",
                  "name": "keyword"
                },
                {
                  "match": "\\b(vertexShader|pixelShader|hullShader|domainShader|computeShader)\\b",
                  "name": "support.function"
                },
                {
                  "match": ".*",
                  "name": "variable.parameter"
                }
              ]
            }
          },
          "end": "(?=//|$|\\s*\\})",
          "patterns": [
            {
              "include": "#parameterValue"
            }
          ]
        }
      ]
    },
    "parameterValue": {
      "patterns": [
        {
          "include": "#annotations"
        },
        {
          "comment": "файл в кавычках",
          "match": "\"(?:[a-zA-Z]:)?(?:[^\"\\\\]|\\\\.)*\\.(?:hlsl|dds|fx|fxh|h|hpp|cpp|txt|json|xml|ini|cfg)\"",
          "name": "meta.preprocessor.numeric"
        },
        {
          "match": "\"[^\"]*\"",
          "name": "string.quoted.double"
        },
        {
          "comment": "путь файла начинается с /",
          "match": "(?:[a-zA-Z]:)?(?:[\\\\/])?(?:[\\w\\-\\.]+[\\\\/])*[\\w\\-\\.]+\\.[a-zA-Z0-9]{2,4}(?=\\s|$)",
          "name": "meta.preprocessor.numeric"
        },
        {
          "comment": "путь файла - filename.ext",
          "match": "[\\w\\-\\.]+\\.[a-zA-Z0-9]{2,4}(?=\\s|$)",
          "name": "meta.preprocessor.numeric"
        },
        {
          "match": "\\b(globalWater|localWater|terrain|sky|surface|particles)\\b",
          "name": "keyword.other"
        },
        {
          "match": "\\b(DepthTexture|RenderTarget|UserTexture)\\b",
          "name": "support.type"
        },
        {
          "match": "\\b(true|false|back|front|none|clamp|wrap|mirror|border|mirrorOnce|point|linear|anisotropic|DepthTexture|RenderTarget|UserTexture)\\b",
          "name": "keyword.control"
        },
        {
          "match": "\\b(srcAlpha|invSrcAlpha|zero|one|srcColor|invSrcColor|destAlpha|invDestAlpha|destColor|invDestColor|srcAlphaSat|blendFactor|invBlendFactor)\\b",
          "name": "keyword.control"
        },
        {
          "match": "\\b(never|less|equal|lessEqual|greater|notEqual|greaterEqual|always|add|subtract|revSubtract|min|max|solid|wireframe|keep|zero|replace|incrSat|decrSat|invert|incr|decr)\\b",
          "name": "keyword.control"
        },
        {
          "match": "-?\\d+\\.\\d+",
          "name": "constant.numeric.float"
        },
        {
          "match": "-?\\d+",
          "name": "constant.numeric.integer"
        },
        {
          "match": "\\S+",
          "name": "variable.other"
        },
        {
          "include": "#comments"
        }
      ]
    },
    "annotations": {
      "patterns": [
        {
          "name": "meta.annotation.myformat",
          "begin": "([A-Za-z_][A-Za-z0-9_]*)<",
          "beginCaptures": {
            "1": {
              "name": "storage.type"
            }
          },
          "end": ">",
          "patterns": [
            {
              "name": "string",
              "match": "[^>]+"
            }
          ]
        }
      ]
    }
  }
}